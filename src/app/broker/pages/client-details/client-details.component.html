<app-dashboard-layout>
    <!-- Loading State -->
    <div *ngIf="loading" class="p-8 flex justify-center">
        <app-loading-spinner></app-loading-spinner>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="p-8 text-center">
        <div class="text-red-500 mb-4">{{ error }}</div>
        <button (click)="goBack()"
            class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
            Back to Clients
        </button>
    </div>

    <!-- Client Details -->
    <div *ngIf="!loading && !error && client" class="space-y-8">
        <!-- Breadcrumb -->
        <div class="flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400">
            <a [routerLink]="['/dashboard/broker/clients']" class="hover:text-primary transition-colors">{{
                'DETAILS.CLIENT.BREADCRUMB' | translate }}</a>
            <span>/</span>
            <span>{{ client.name }}</span>
        </div>

        <!-- Header -->
        <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
            <div class="flex items-center gap-4">
                <div
                    class="w-16 h-16 bg-blue-50 dark:bg-blue-900/30 rounded-full flex items-center justify-center text-primary border-2 border-white shadow-sm">
                    <i data-lucide="user" class="w-8 h-8"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-navy dark:text-white">{{ client.name }}</h1>
                    <p *ngIf="client.arabicName" class="text-lg text-gray-600 dark:text-gray-300 mt-1">{{
                        client.arabicName }}</p>
                    <div class="flex items-center gap-4 text-sm text-gray-600 dark:text-gray-300 mt-1">
                        <span class="flex items-center gap-1">
                            <i data-lucide="mail" class="w-3 h-3"></i> {{ client.email }}
                        </span>
                        <span class="flex items-center gap-1">
                            <i data-lucide="phone" class="w-3 h-3"></i> {{ client.phone }}
                        </span>
                    </div>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <button (click)="createClaim()"
                    class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2">
                    <i data-lucide="alert-circle" class="w-4 h-4"></i>
                    Intimate Claim
                </button>
                <button (click)="createQuote()"
                    class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors flex items-center gap-2">
                    <i data-lucide="plus" class="w-4 h-4"></i>
                    New Quote
                </button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="border-b border-gray-200 dark:border-gray-700">
            <div class="flex gap-8">
                <button *ngFor="let tab of ['overview', 'policies', 'claims', 'documents']" (click)="setActiveTab(tab)"
                    [ngClass]="{'text-primary': activeTab === tab, 'text-gray-500 dark:text-gray-400 hover:text-gray-700': activeTab !== tab}"
                    class="pb-4 text-sm font-medium capitalize transition-all duration-300 relative">
                    {{ tab }}
                    <div *ngIf="activeTab === tab"
                        class="absolute bottom-0 left-0 right-0 h-0.5 bg-primary rounded-t-full"></div>
                </button>
            </div>
        </div>

        <!-- Content -->
        <div class="space-y-6">
            <!-- Overview Tab -->
            <div *ngIf="activeTab === 'overview'" class="space-y-6">
                <!-- Client Information -->
                <div
                    class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 hover:shadow-md transition-all duration-300">
                    <h3 class="font-bold text-navy dark:text-white mb-4">Client Information</h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-y-4 text-sm">
                        <div>
                            <p class="text-gray-500 dark:text-gray-400">Full Name</p>
                            <p class="font-medium text-navy dark:text-white">{{ client.name }}</p>
                        </div>
                        <div *ngIf="client.arabicName">
                            <p class="text-gray-500 dark:text-gray-400">Arabic Name</p>
                            <p class="font-medium text-navy dark:text-white">{{ client.arabicName }}</p>
                        </div>
                        <div *ngIf="!client.isForeignCustomer">
                            <p class="text-gray-500 dark:text-gray-400">Client ID</p>
                            <p class="font-medium text-navy dark:text-white">{{ client.id }}</p>
                        </div>
                        <div *ngIf="client.isForeignCustomer">
                            <p class="text-gray-500 dark:text-gray-400">Is Passport</p>
                            <p class="font-medium text-navy dark:text-white">Yes</p>
                        </div>
                        <div *ngIf="client.isForeignCustomer && client.passportId">
                            <p class="text-gray-500 dark:text-gray-400">Passport Number</p>
                            <p class="font-medium text-navy dark:text-white">{{ client.passportId }}</p>
                        </div>
                        <div>
                            <p class="text-gray-500 dark:text-gray-400">Email</p>
                            <p class="font-medium text-navy dark:text-white">{{ client.email }}</p>
                        </div>
                        <div>
                            <p class="text-gray-500 dark:text-gray-400">Phone</p>
                            <p class="font-medium text-navy dark:text-white">{{ client.phone }}</p>
                        </div>
                        <div *ngIf="client.dateOfBirth">
                            <p class="text-gray-500 dark:text-gray-400">Date of Birth</p>
                            <p class="font-medium text-navy dark:text-white">{{ client.dateOfBirth }}</p>
                        </div>
                        <div *ngIf="client.gender">
                            <p class="text-gray-500 dark:text-gray-400">Gender</p>
                            <p class="font-medium text-navy dark:text-white capitalize">{{ client.gender }}</p>
                        </div>
                        <div class="col-span-2 md:col-span-3 lg:col-span-4">
                            <p class="text-gray-500 dark:text-gray-400">Address</p>
                            <p class="font-medium text-navy dark:text-white">{{ client.address }}<span
                                    *ngIf="client.city">, {{ client.city }}</span><span *ngIf="client.stateName">,
                                    {{ client.stateName }}</span><span *ngIf="client.countryName">, {{
                                    client.countryName }}</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Policies Tab -->
            <div *ngIf="activeTab === 'policies'" class="space-y-4">
                <div *ngIf="client.policies.length === 0" class="text-center py-12">
                    <i data-lucide="shield" class="mx-auto h-12 w-12 text-gray-400 mb-4"></i>
                    <p class="text-gray-500 dark:text-gray-400">No policies found for this client.</p>
                </div>
                <div *ngFor="let policy of client.policies"
                    class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 flex items-center justify-between hover:shadow-md transition-all duration-300">
                    <div class="flex items-center gap-4">
                        <div
                            class="w-10 h-10 bg-blue-50 dark:bg-blue-900/30 rounded-lg flex items-center justify-center text-primary">
                            <i data-lucide="shield" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-navy dark:text-white">{{ policy.type }} Insurance</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-300">{{ policy.vehicle || policy.property
                                }}</p>
                            <p class="text-xs text-gray-400">{{ policy.id }}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs font-bold uppercase">{{
                            policy.status }}</span>
                        <p class="text-sm font-bold text-navy dark:text-white mt-1">EGP {{
                            policy.premium?.toLocaleString() }}</p>
                        <a [routerLink]="['/dashboard/broker/policies', policy.id]"
                            class="text-xs text-primary hover:underline block mt-1">View Details</a>
                    </div>
                </div>
            </div>

            <!-- Claims Tab -->
            <div *ngIf="activeTab === 'claims'" class="space-y-4">
                <div *ngIf="client.claims.length === 0" class="text-center py-12">
                    <i data-lucide="alert-circle" class="mx-auto h-12 w-12 text-gray-400 mb-4"></i>
                    <p class="text-gray-500 dark:text-gray-400">No claims found for this client.</p>
                </div>
                <div *ngFor="let claim of client.claims"
                    class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 flex items-center justify-between hover:shadow-md transition-all duration-300">
                    <div class="flex items-center gap-4">
                        <div
                            class="w-10 h-10 bg-red-50 dark:bg-red-900/30 rounded-lg flex items-center justify-center text-red-500">
                            <i data-lucide="alert-circle" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-navy dark:text-white">{{ claim.type }}</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-300">Policy: {{ claim.policyId }}</p>
                            <p class="text-xs text-gray-400">{{ claim.date }}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs font-bold uppercase">{{
                            claim.status }}</span>
                        <p class="text-sm font-medium text-gray-600 dark:text-gray-300 mt-1">Est. EGP {{
                            claim.amount?.toLocaleString() }}</p>
                        <a [routerLink]="['/dashboard/broker/claims', claim.id]"
                            class="text-xs text-primary hover:underline block mt-1">View Details</a>
                    </div>
                </div>
            </div>

            <!-- Documents Tab -->
            <div *ngIf="activeTab === 'documents'" class="space-y-4">
                <div class="text-center py-12">
                    <i data-lucide="file-text" class="mx-auto h-12 w-12 text-gray-400 mb-4"></i>
                    <p class="text-gray-500 dark:text-gray-400">No documents available.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Customer Selection Modal -->
    <app-customer-selection-modal *ngIf="isCustomerModalOpen" [isOpen]="isCustomerModalOpen"
        [prefilledNationalId]="client?.nationalId || client?.id || ''" (close)="isCustomerModalOpen = false"
        (selectCustomer)="onCustomerSelected($event)">
    </app-customer-selection-modal>

    <!-- Chassis Validation Modal -->
    <app-chassis-validation-modal [isOpen]="isChassisModalOpen" (close)="isChassisModalOpen = false">
    </app-chassis-validation-modal>
</app-dashboard-layout>