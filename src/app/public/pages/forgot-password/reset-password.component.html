<app-auth-layout [title]="success ? ('AUTH.RESET.SUCCESS_TITLE' | translate) : ('AUTH.RESET.TITLE' | translate)"
    [subtitle]="success ? ('AUTH.RESET.SUCCESS_SUBTITLE' | translate) : ('AUTH.RESET.SUBTITLE' | translate)">

    <div *ngIf="success" class="text-center py-8">
        <div
            class="inline-flex items-center justify-center w-20 h-20 bg-green-100 dark:bg-green-900/30 rounded-full mb-6">
            <i-lucide name="check-circle" class="w-10 h-10 text-green-600 dark:text-green-400"></i-lucide>
        </div>
        <p class="mb-6 text-lg font-medium text-gray-900 dark:text-white">
            {{ 'AUTH.RESET.REDIRECTING' | translate }}
        </p>
        <div class="flex justify-center">
            <i-lucide name="loader-2" class="h-8 w-8 animate-spin text-primary"></i-lucide>
        </div>
    </div>

    <form *ngIf="!success" class="space-y-6" (submit)="handleSubmit()">
        <!-- Password Requirements Info -->
        <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
            <div class="flex items-start gap-3">
                <i-lucide name="info" class="w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"></i-lucide>
                <div class="text-sm text-blue-800 dark:text-blue-300">
                    <p class="font-semibold mb-1">{{ 'AUTH.RESET.REQUIREMENTS_TITLE' | translate }}</p>
                    <ul class="list-disc list-inside space-y-0.5 text-blue-700 dark:text-blue-400">
                        <li>{{ 'AUTH.RESET.REQ_LENGTH' | translate }}</li>
                        <li>{{ 'AUTH.RESET.REQ_CASE' | translate }}</li>
                        <li>{{ 'AUTH.RESET.REQ_SPECIAL' | translate }}</li>
                    </ul>
                </div>
            </div>
        </div>

        <div>
            <app-text-input [label]="'AUTH.RESET.NEW_PASSWORD' | translate" name="password" type="password" icon="lock"
                [(ngModel)]="password" (ngModelChange)="calculatePasswordStrength()" [placeholder]="'......'"
                [required]="true" [error]="errors.password">
            </app-text-input>

            <!-- Password Strength Indicator -->
            <div *ngIf="password && passwordStrength" class="mt-2">
                <div class="flex items-center justify-between mb-1">
                    <span class="text-xs font-medium text-gray-600 dark:text-gray-400">Password Strength:</span>
                    <span class="text-xs font-semibold" [ngClass]="{
                            'text-red-600 dark:text-red-400': passwordStrength === 'weak',
                            'text-yellow-600 dark:text-yellow-400': passwordStrength === 'medium',
                            'text-green-600 dark:text-green-400': passwordStrength === 'strong'
                        }">
                        {{ passwordStrength === 'weak' ? ('AUTH.RESET.WEAK' | translate) : passwordStrength === 'medium'
                        ? ('AUTH.RESET.MEDIUM' | translate) : ('AUTH.RESET.STRONG' | translate) }}
                    </span>
                </div>
                <div class="flex gap-1">
                    <div class="h-1.5 flex-1 rounded-full transition-all" [ngClass]="{
                            'bg-red-500': passwordStrength === 'weak',
                            'bg-yellow-500': passwordStrength === 'medium',
                            'bg-green-500': passwordStrength === 'strong'
                        }"></div>
                    <div class="h-1.5 flex-1 rounded-full transition-all" [ngClass]="{
                            'bg-gray-200 dark:bg-gray-700': passwordStrength === 'weak',
                            'bg-yellow-500': passwordStrength === 'medium',
                            'bg-green-500': passwordStrength === 'strong'
                        }"></div>
                    <div class="h-1.5 flex-1 rounded-full transition-all" [ngClass]="{
                            'bg-gray-200 dark:bg-gray-700': passwordStrength !== 'strong',
                            'bg-green-500': passwordStrength === 'strong'
                        }"></div>
                </div>
            </div>
        </div>

        <app-text-input [label]="'AUTH.RESET.CONFIRM_PASSWORD' | translate" name="confirmPassword" type="password"
            icon="lock" [(ngModel)]="confirmPassword" [placeholder]="'......'" [required]="true"
            [error]="errors.confirmPassword">
        </app-text-input>

        <!-- Error Alert -->
        <div *ngIf="errors.form"
            class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4">
            <div class="flex items-start gap-3">
                <i-lucide name="alert-circle"
                    class="w-5 h-5 text-red-600 dark:text-red-400 mt-0.5 flex-shrink-0"></i-lucide>
                <p class="text-sm text-red-800 dark:text-red-300 font-medium">{{ errors.form }}</p>
            </div>
        </div>

        <button type="submit" [disabled]="loading"
            class="w-full h-12 flex items-center justify-center gap-2 bg-primary hover:bg-primary/90 text-white font-bold rounded-xl transition-all shadow-lg shadow-primary/20 disabled:opacity-70 disabled:cursor-not-allowed">
            <i-lucide *ngIf="loading" name="loader-2" class="w-5 h-5 animate-spin"></i-lucide>
            <i-lucide *ngIf="!loading" name="lock" class="w-5 h-5"></i-lucide>
            {{ loading ? ('AUTH.RESET.RESETTING' | translate) : ('AUTH.RESET.RESET_BTN' | translate) }}
        </button>
    </form>
</app-auth-layout>